# QR Code System - Quick Reference

## ðŸŽ¯ Two Admin Tools Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ADMIN PANEL - QR TOOLS                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ðŸ”² ALL PERMITS         â”‚    â”‚   ðŸ“‹ INDIVIDUAL          â”‚
â”‚                          â”‚    â”‚                          â”‚
â”‚  Display all active +    â”‚    â”‚  Search & select one     â”‚
â”‚  pending permits with    â”‚    â”‚  permit, generate        â”‚
â”‚  QR codes in grid        â”‚    â”‚  detailed QR code        â”‚
â”‚                          â”‚    â”‚                          â”‚
â”‚  â€¢ Print all at once     â”‚    â”‚  â€¢ Search by ref/holder  â”‚
â”‚  â€¢ Auto-refresh 60s      â”‚    â”‚  â€¢ Large QR display      â”‚
â”‚  â€¢ Company branding      â”‚    â”‚  â€¢ Print individual      â”‚
â”‚  â€¢ PDF export            â”‚    â”‚  â€¢ Download QR image     â”‚
â”‚  â€¢ Stats dashboard       â”‚    â”‚  â€¢ Mobile friendly       â”‚
â”‚                          â”‚    â”‚                          â”‚
â”‚  BEST FOR:               â”‚    â”‚  BEST FOR:               â”‚
â”‚  âœ“ Notice boards         â”‚    â”‚  âœ“ Specific stakeholders â”‚
â”‚  âœ“ Batch printing        â”‚    â”‚  âœ“ Email sharing         â”‚
â”‚  âœ“ Quick overview        â”‚    â”‚  âœ“ Custom prints         â”‚
â”‚  âœ“ Large displays        â”‚    â”‚  âœ“ Single permit focus   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸŒ Feature Matrix

| Feature | All Permits | Individual |
|---------|:-----------:|:----------:|
| Display Multiple | âœ… | âŒ |
| Search | âœ… | âœ… |
| Company Logo | âœ… | âœ… |
| Print to PDF | âœ… | âœ… |
| Download QR | âŒ | âœ… |
| Auto-Refresh | âœ… | âŒ |
| Permit Details | Basic | Full |
| Mobile Friendly | âœ… | âœ… |
| Batch Operations | âœ… | âŒ |
| Grid Layout | âœ… | âŒ |

---

## ðŸ“± Device Support

### Desktop (1920px+)
- All Permits: 3-column grid
- Individual: 2-column layout (sidebar + viewer)

### Tablet (768-1024px)
- All Permits: 2-column grid
- Individual: Responsive stacking

### Mobile (320-768px)
- All Permits: 1-column grid
- Individual: Stacked layout with full-width search

---

## ðŸ–¨ï¸ Print Workflow

### Step 1: Navigate
```
Admin Panel â†’ QR Codes (All or Individual)
```

### Step 2: Select
```
All Permits: Auto-displayed
Individual: Search and select from list
```

### Step 3: Print
```
Click "Print / Save as PDF" button
â†“
Browser print dialog opens
â†“
Select "Save as PDF"
â†“
Configure margins (narrow recommended)
â†“
Save file with descriptive name
```

### Step 4: Use
```
Print PDF on standard or large format
Post on notice board
Share via email
Archive for records
```

---

## ðŸ” Access Control

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User Requests QR Page        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Session Active?                â”‚
â”‚  (Check $_SESSION['user_id'])   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        No  â”‚  Yes
            â”‚  â”‚
            â”‚  â–¼
            â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ â”‚ User Role = Admin?              â”‚
            â”‚ â”‚ (Check $currentUser['role'])    â”‚
            â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚          No  â”‚  Yes
            â”‚              â”‚  â”‚
            â–¼              â–¼  â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ DENIED  â”‚      â”‚ ALLOWED    â”‚
      â”‚ Redirectâ”‚      â”‚ Load Page  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“Š Data Flow

### QR Generation Process

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database Query                   â”‚
â”‚ SELECT forms WHERE status IN     â”‚
â”‚ ('active', 'pending_approval')   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ For Each Permit:                 â”‚
â”‚ - Get unique_link                â”‚
â”‚ - Build full URL                 â”‚
â”‚ - Generate QR code               â”‚
â”‚ - Convert to base64              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Render HTML with:                â”‚
â”‚ - Company logo (from settings)   â”‚
â”‚ - Company name (from settings)   â”‚
â”‚ - Permit details                 â”‚
â”‚ - QR code image                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸŽ¨ Color Scheme

### Status Colors
```
Active Permit          Pending Approval       Error
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”€â”€â”€â”€â”€
Background: #10b98120  Background: #f59e0b20  Background: #ef444420
Text: #10b981          Text: #f59e0b          Text: #ef4444
```

### UI Colors
```
Primary Accent         Secondary Text         Border
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”€â”€â”€â”€â”€â”€
#06b6d4 (Cyan)         #94a3b8 (Slate)        #1e293b (Dark)
#0ea5e9 (Sky)          #64748b (Dark Slate)   #334155 (Darker)
```

---

## âš™ï¸ Configuration Options

### Edit Auto-Refresh Interval (All Permits)
```javascript
// Change from 60000ms to desired milliseconds
setTimeout(() => {
    location.reload();
}, 60000);  // 60 seconds

// Examples:
// 30000 = 30 seconds
// 120000 = 2 minutes
// 300000 = 5 minutes
```

### Edit Grid Columns (All Permits)
```css
.qr-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);  /* Change 3 to 2, 4, etc */
    gap: 24px;
}
```

### Edit QR Code Scale
```php
$qrOptions = new QROptions([
    'scale' => 5,  // Change 3-10 (larger = bigger QR)
    'quietzoneSize' => 2,
]);
```

---

## ðŸ” Search Capabilities (Individual Page)

### Search by:
- âœ… Permit Reference Number (e.g., "PTW-2025-001")
- âœ… Template Type (e.g., "Work at Height")
- âœ… Holder Name (e.g., "John Smith")
- âœ… Holder Email (e.g., "john@example.com")
- âœ… Partial matches (e.g., "2025" matches all 2025 permits)

### Search Examples:
```
Query: "PTW"           â†’ All permits starting with PTW
Query: "Height"        â†’ All Work at Height permits
Query: "john"          â†’ Permits for users with "john" in name/email
Query: "active"        â†’ Filters by status
```

---

## ðŸ“‹ Permit Information Displayed

### All Permits Page (Per Card):
- Permit Reference Number
- Template Type
- Status Badge (Active/Pending)
- QR Code
- Scan Instructions

### Individual Page (Full Details):
- Permit Reference Number
- Template Type
- Current Status (with color badge)
- Permit Holder
- Created Date & Time
- Valid From & To Dates
- Large QR Code
- Scan Instructions

---

## ðŸš€ Integration Points

### Database Tables Used:
```
forms
â”œâ”€â”€ id
â”œâ”€â”€ ref_number
â”œâ”€â”€ template_id
â”œâ”€â”€ status
â”œâ”€â”€ holder_id
â”œâ”€â”€ unique_link
â””â”€â”€ created_at

form_templates
â”œâ”€â”€ id
â””â”€â”€ name

users
â”œâ”€â”€ id
â”œâ”€â”€ name
â””â”€â”€ email

settings
â”œâ”€â”€ key
â””â”€â”€ value
```

### External Functions Used:
```
SystemSettings::companyName($db)
SystemSettings::companyLogoPath($db)
asset(path)
app->url(path)
htmlspecialchars()
```

---

## âœ… Validation Checklist

Before deploying, verify:
- [ ] PHP version 8.0+ installed
- [ ] chillerlan/qr-code package available
- [ ] Company logo uploaded via System Settings
- [ ] Permits exist with active/pending status
- [ ] Permits have unique_link generated
- [ ] Admin accounts have 'admin' role
- [ ] Browser supports print-to-PDF
- [ ] All files have no syntax errors

---

## ðŸ†˜ Common Issues & Solutions

| Issue | Cause | Solution |
|-------|-------|----------|
| No QR codes showing | Missing unique_link | Run permit creation with link generation |
| Logo not visible | Path misconfigured | Check System Settings â†’ upload logo |
| Can't access pages | Not admin | Login with admin account |
| PDF too large | High QR scale | Reduce 'scale' value in code |
| QR won't scan | Damaged generation | Check chillerlan package installed |
| Print missing content | Print margins too tight | Adjust margins in print dialog |

---

## ðŸ“ž Support

For issues or questions:
1. Check QR_CODE_SYSTEM.md for detailed docs
2. Verify admin access and roles
3. Check browser console for JavaScript errors
4. Verify database connectivity
5. Check file permissions for logos

---

**Quick Links:**
- Admin Panel: `/admin.php`
- All Permits QR: `/admin/qr-codes-all.php`
- Individual QR: `/admin/qr-codes-individual.php`
- System Settings: `/admin/settings.php`
- Full Docs: `QR_CODE_SYSTEM.md`

**Last Updated**: 01/11/2025  
**Version**: 1.0  
**Status**: Production Ready âœ…
